<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="favicon/favicon.ico">
    <title>Off Canvas Template for Bootstrap</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/ie10-viewport-bug-workaround.css" rel="stylesheet">
    <link href="offcanvas.css" rel="stylesheet">
    <script src="js/ie8-responsive-file-warning.js"></script>
    <script src="js/ie-emulation-modes-warning.js"></script>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <script src="js/jquery.min.js"></script>

</head>
<body>
<nav class="navbar navbar-fixed-top navbar-inverse">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
                    aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">基金管理</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
                <li class="active"><a href="#" onclick="fundNetWorth(this)">基金曲线图</a></li>
                <li><a onclick="fundMakeShare(this)">基金收益</a></li>
                <li><a href="#contact">基金订单</a></li>
            </ul>
        </div>
    </div>
</nav>

<div class="container">
    <div class="row row-offcanvas row-offcanvas-right">
        <div class="col-xs-12 col-sm-18">
            <div class="input-group"  id="input-group">
                <div class="input-group-btn">
                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="false">请选择基金 <span class="caret"></span></button>
                    <ul class="dropdown-menu" id="fundList">
                    </ul>
                </div><!-- /btn-group -->
                <input type="text" id="input" class="form-control" aria-label="...">
            </div>
            <div class="jumbotron">
                <div id="echart" style="width:100%;height:400px"></div>
            </div>
        </div>
    </div>
</div>

<script src="js/echarts.js"/>
<script>window.jQuery || document.write('<script src="js/jquery.min.v2.js"><\/script>')</script>
<script src="js/bootstrap.min.js"></script>
<script src="js/ie10-viewport-bug-workaround.js"></script>
<script src="offcanvas.js"></script>
<script type="text/javascript">
    var lineData = new Array();
    lineData[0] = [
        {type: 'min', name: '最大'},
        {type: 'max', name: '最大'}
    ]
    var myChart = echarts.init(document.getElementById('echart'));
    var objectJson = {code: 519120};

    /**
     * 初始化的基金曲线图
     */
    (function () {
        $.post("http://localhost:8082/rest/fundNetworth", JSON.stringify(objectJson), function (data) {
            lineOption(data);
        }, "json");

        $.post("http://localhost:8082/rest/fundList", JSON.stringify(objectJson), function (data) {
            for (var i = 0; i < data.attentionFundList.length; i++) {
                var ss = ("<li><a onclick=\"choiceFund('" + data.attentionFundList[i].fundCode + "','" + data.attentionFundList[i].fundName + "')\">" +
                data.attentionFundList[i].fundName + "</a></li>");
                $("#fundList").append(ss);
            }
        }, "json");
    })();

    /**
     * 更改基金的曲线图
     */
    function fundNetWorth(ss) {
        $.post("http://localhost:8082/rest/fundNetworth", JSON.stringify(objectJson), function (data) {
            lineOption(data);
        }, "json");
        $("#input-group").show();
        clickText(ss);
    }

    /**
     * 选择基金
     */
    function choiceFund(fundCode, fundName) {
        $("#input").html(fundName);
        $("#input").val(fundName);
        objectJson = {code: fundCode}
        $.post("http://localhost:8082/rest/fundNetworth", JSON.stringify(objectJson), function (data) {
            lineOption(data);
        }, "json");
    }

    /**
     * 基金赚取的份额
     */
    function fundMakeShare(ss) {
        $.post("http://localhost:8082/rest/makeshare", JSON.stringify(objectJson), function (data) {
            gradient(data);
        }, "json");
        $("#input-group").hide();
        clickText(ss)
    }

    /**
     * 点击菜单,变化菜单样式
     */
    function clickText(ss) {
        $("li").removeClass("active");
        $(ss).parent().addClass("active");
    }

    /**
     *
     */
    function gradient(data) {
        var dataAxis=[];
        var dataYxis=[];
        var dataShadow=[];
        var makeShares = data.makeShareList;
        var maxMakeShare = data.max;
        for(var i=0;i<makeShares.length;i++) {
            var value=makeShares[i].code+":"+makeShares[i].total;
            dataAxis.push(value);
            dataYxis.push(makeShares[i].total);
            dataShadow.push(maxMakeShare);
        }
        var option = {
            title: {
                text: '赚取基金份额',
                subtext: 'Feature Sample: Gradient Color, Shadow, Click Zoom'
            },
            xAxis: {
                data: dataAxis,
                axisLabel: {
                    inside: true,
                    textStyle: {
                        color: '#666633'
                    }
                },
                axisTick: {
                    show: false
                },
                axisLine: {
                    show: false
                },
                z: 10
            },
            yAxis: {
                axisLine: {
                    show: false
                },
                axisTick: {
                    show: false
                },
                axisLabel: {
                    textStyle: {
                        color: '#999'
                    }
                }
            },
            dataZoom: [
                {
                    type: 'inside'
                }
            ],
            series: [
                {
                    type: 'bar',
                    itemStyle: {
                        normal: {color: 'rgba(0,0,0,0.05)'}
                    },
                    barGap:'-100%',
                    barCategoryGap:'40%',
                    data: dataShadow,
                    animation: false
                },
                {
                    type: 'bar',
                    itemStyle: {
                        normal: {
                            color: new echarts.graphic.LinearGradient(
                                0, 0, 0, 1,
                                [
                                    {offset: 0, color: '#ff6600'},
                                    {offset: 0.5, color: '#ff6633'},
                                    {offset: 1, color: '#ff6666'}
                                ]
                            )
                        },
                        emphasis: {
                            color: new echarts.graphic.LinearGradient(
                                0, 0, 0, 1,
                                [
                                    {offset: 0, color: '#ff6600'},
                                    {offset: 0.7, color: '#ff6633'},
                                    {offset: 1, color: '#ff6666'}
                                ]
                            )
                        }
                    },
                    data: dataYxis
                }
            ]
        };
        // 使用刚指定的配置项和数据显示图表。
        myChart = echarts.init(document.getElementById('echart'));
        myChart.setOption(option);
        myChart.on('mouseOver', function (params) {
            for(var i=0;i<makeShares.length;i++) {
                var value=makeShares[i].code+":"+makeShares[i].total;
                if(params.name==value){
                    option.title.text=makeShares[i].name;
                    break;
                }
            }
            myChart.setOption(option)
        });
    }
    /**
     * 组装后端基金净值数据echart对应格式
     * @param data
     */
    function lineOption(data) {
        var temp = new Array();
        var time = new Array();
        for (var i = 0; i < data.fundNetWorthList.length; i++) {
            time[i] = data.fundNetWorthList[i].time;
            temp[i] = data.fundNetWorthList[i].netWorth;
        }
        var option = {
            title: {
                show: true,
                text: data.fundName
            },
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    animation: false
                }
            },
            xAxis: {
                data: time,
                splitLine: {
                    show: false
                }
            },
            yAxis: {
                position: 'left',
                boundaryGap: [0, '30%'],
                splitLine: {
                    show: false
                },
                min:'dataMin',
                max:'dataMax'
            }
            ,
            dataZoom: {
                start: 80,
                end: 100
            }
            ,
            series: [{
                type: 'line',
                hoverAnimation: true,
                smooth: true,
                data: temp,
                markLine: {
                    smooth: true,
                    symbol: ['none', 'arrow'],
                    symbolSize: 10,
                    effect: {
                        show: true,
                        color: 'green',
                        shadowColor: 'black',
                        period: 30
                    },
                    itemStyle: {
                        normal: {
                            color: 'green',
                            borderWidth: 6,
                            borderColor: 'green',
                            lineStyle: {
                                type: 'solid'
                            }
                        }
                    },
                    data: lineData
                }
            }]
        };
        // 使用刚指定的配置项和数据显示图表。
        myChart = echarts.init(document.getElementById('echart'));
        myChart.setOption(option);
    }
</script>
</body>


</html>
