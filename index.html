<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="favicon/favicon.ico">
    <title>Off Canvas Template for Bootstrap</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/ie10-viewport-bug-workaround.css" rel="stylesheet">
    <link href="offcanvas.css" rel="stylesheet">
    <script src="js/ie8-responsive-file-warning.js"></script>
    <script src="js/ie-emulation-modes-warning.js"></script>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <script src="js/jquery.min.js"></script>

</head>
<body>
<nav class="navbar navbar-fixed-top navbar-inverse">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
                    aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">基金管理</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
                <li class="active"><a href="#">基金曲线图</a></li>
                <li><a href="#about">基金收益</a></li>
                <li><a href="#contact">基金订单</a></li>
            </ul>
        </div>
    </div>
</nav>

<div class="container">
    <div class="row row-offcanvas row-offcanvas-right">
        <div class="col-xs-12 col-sm-18">
            <div class="input-group">
                <div class="input-group-btn">
                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="false">请选择基金 <span class="caret"></span></button>
                    <ul class="dropdown-menu" id="fundList">
                    </ul>
                </div><!-- /btn-group -->
                <input type="text" id="input" class="form-control" aria-label="...">
            </div>
            <div class="jumbotron">
                <div id="echart" style="width:100%;height:400px"></div>
            </div>
        </div>
    </div>
</div>

<script src="js/echarts.js"/>
<script>window.jQuery || document.write('<script src="js/jquery.min.v2.js"><\/script>')</script>
<script src="js/bootstrap.min.js"></script>
<script src="js/ie10-viewport-bug-workaround.js"></script>
<script src="offcanvas.js"></script>
<script type="text/javascript">
    var lineData = new Array();
    lineData[0] = [
        {type: 'min', name: '最大'},
        {type: 'max', name: '最大'}
    ]
    var myChart = echarts.init(document.getElementById('echart'));
    var objectJson = {code: 519120};

    /**
     * 更改基金的曲线图
     */
    function fundNetWorth() {
        objectJson = {code: $("#fundCode").val()}
        $.post("http://localhost:8082/rest/fundNetworth", JSON.stringify(objectJson), function (data) {
            lineOption(data);
        }, "json");

    }

    /**
     * 初始化的基金曲线图
     */
    (function () {
        $.post("http://localhost:8082/rest/fundNetworth", JSON.stringify(objectJson), function (data) {
            lineOption(data);
        }, "json");

        $.post("http://localhost:8082/rest/fundList", JSON.stringify(objectJson), function (data) {
            for (var i = 0; i < data.attentionFundList.length; i++) {
                var ss = ("<li><a onclick=\"choiceFund('" + data.attentionFundList[i].fundCode + "','" + data.attentionFundList[i].fundName + "')\">" +
                data.attentionFundList[i].fundName + "</a></li>");
                $("#fundList").append(ss);
            }
        }, "json");
    })();


    /**
     * 选择基金
     */
    function choiceFund(fundCode, fundName) {
        $("#input").html(fundName);
        $("#input").val(fundName);
        objectJson = {code: fundCode}
        $.post("http://localhost:8082/rest/fundNetworth", JSON.stringify(objectJson), function (data) {
            lineOption(data);
        }, "json");
    }

    /**
     * 组装后端基金净值数据echart对应格式
     * @param data
     */
    function lineOption(data) {
        var temp = new Array();
        var time = new Array();
        for (var i = 0; i < data.fundNetWorthList.length; i++) {
            time[i] = data.fundNetWorthList[i].time;
            temp[i] = data.fundNetWorthList[i].netWorth;
        }
        var option = {
            title: {
                show: true,
                text: data.fundName
            },
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    animation: false
                }
            },
            xAxis: {
                data: time,
                splitLine: {
                    show: false
                }
            },
            yAxis: {
                position: 'left',
                boundaryGap: [0, '30%'],
                splitLine: {
                    show: false
                },
                min:'dataMin',
                max:'dataMax'
            }
            ,
            dataZoom: {
                start: 80,
                end: 100
            }
            ,
            series: [{
                type: 'line',
                hoverAnimation: true,
                smooth: true,
                data: temp,
                markLine: {
                    smooth: true,
                    symbol: ['none', 'arrow'],
                    symbolSize: 10,
                    effect: {
                        show: true,
                        color: 'green',
                        shadowColor: 'black',
                        period: 30
                    },
                    itemStyle: {
                        normal: {
                            color: 'green',
                            borderWidth: 6,
                            borderColor: 'green',
                            lineStyle: {
                                type: 'solid'
                            }
                        }
                    },
                    data: lineData
                }
            }]
        };
        // 使用刚指定的配置项和数据显示图表。
        myChart.setOption(option);
    }
</script>
</body>


</html>
